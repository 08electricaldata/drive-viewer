<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Drive History</title>

<style>
/* (STYLES UNCHANGED ‚Äî EXACTLY SAME AS YOUR FILE) */
body {
  font-family: Arial, sans-serif;
  padding: 0;
  margin: 0;
  background: #f2f6ff;
}
.header-bar {
  position: sticky;
  top: 0;
  z-index: 1000;
  background: #003f88;
  color: white;
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px;
}
.header-bar button {
  background: white;
  color: #003f88;
  border: none;
  border-radius: 6px;
  padding: 8px 12px;
  font-size: 16px;
  cursor: pointer;
}
.header-title {
  flex: 1;
  text-align: center;
  font-size: 20px;
  font-weight: 700;
}
.header-credit {
  font-size: 16px;
  font-weight: 500;
  opacity: 0.9;
  white-space: nowrap;
}
.page { padding: 20px; }
h2, h3 {
  color: #003f88;
  text-align: center;
  font-weight: 700;
}
h2 { font-size: 34px; margin-bottom: 10px; }
h3 { font-size: 22px; margin-bottom: 10px; }
.card {
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  margin-bottom: 20px;
}
.grid {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 16px;
}
.label { font-weight: bold; color: #003f88; }
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}
th, td {
  border: 1px solid #ccc;
  padding: 6px 8px;
}
th {
  background: #003f88;
  color: white;
}
.year-row td {
  background: #e8f0ff;
  color: #003f88;
  font-weight: 700;
  text-align: center;
}
</style>
</head>

<body>

<div class="header-bar">
  <button onclick="goHome()">üè† Home</button>
  <button onclick="goBack()">‚¨Ö Back</button>
  <button onclick="goDriveInfo()">‚ÑπÔ∏è Drive Info</button>
  <div class="header-title">Drive History</div>
  <div class="header-credit">Designed and Maintained by Rakesh Chandra Sethy</div>
</div>

<div class="page">
<h2>Drive Information</h2>
<div id="driveInfo" class="card">Loading drive information‚Ä¶</div>

<h2>History</h2>
<div class="card">
<table id="historyTable">
<thead>
<tr>
<th>TR NO</th>
<th>MONTH</th>
<th>DATE</th>
<th>DETAILS OF JOB</th>
<th>JOB TYPE</th>
<th>JOB CATEGORY</th>
<th>CARRIED OUT BY</th>
<th>LINK</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>

<script>
/* ========= NORMALIZE (üî• ONLY ADDITION) ========= */
function normalize(v){
  return String(v || "")
    .replace(/[‚Äì‚Äî?]/g, "-")
    .toUpperCase()
    .trim();
}

const rawId = new URLSearchParams(location.search).get("id");
const id = normalize(rawId);

/* ===== NAV ===== */
function goHome(){ location.href="https://08electricaldata.github.io/"; }
function goBack(){ history.back(); }
function goDriveInfo(){
  if(!id) return;
  location.href =
    "https://08electricaldata.github.io/drive-viewer/index.html?id=" +
    encodeURIComponent(id);
}

/* ===== DRIVE INFO ===== */
async function loadDriveInfo(){
  if(!id) return;

  const url="https://raw.githubusercontent.com/08electricaldata/08electricaldata-json/main/drive.json";
  const j=await (await fetch(url)).json();

  let c=null;
  j.rows.forEach(r=>{
    if(normalize(`${r[1]}-${r[2]}`) === id) c=r;
  });

  if(!c){
    driveInfo.innerHTML="Drive not found.";
    return;
  }

  driveInfo.innerHTML=`<h3>${c[1]} ‚Äì ${c[2]}</h3>`;
}

/* ===== HISTORY ===== */
const HISTORY_YEARS=[2026,2025,2024,2023,2022,2021,2020,2019];
const HISTORY_BASE="https://raw.githubusercontent.com/08electricaldata/08electricaldata-json/main/history/";

async function loadHistory(){
  let all=[];

  for(const y of HISTORY_YEARS){
    try{
      const j=await (await fetch(HISTORY_BASE+y+".json")).json();
      j.rows.forEach(row=>{
        if(normalize(`${row[2]}-${row[3]}`) === id){
          all.push(row);
        }
      });
    }catch(e){}
  }

  renderHistory(all);
}

function renderHistory(rows){
  const tbody=document.querySelector("#historyTable tbody");
  tbody.innerHTML="";

  rows.forEach(r=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${r[0]||""}</td>
      <td>${r[1]||""}</td>
      <td>${r[4]||""}</td>
      <td>${r[5]||""}</td>
      <td>${r[6]||""}</td>
      <td>${r[7]||""}</td>
      <td>${r[9]||""}</td>
      <td>${r[10]?`<a href="${r[10]}" target="_blank">Open</a>`:""}</td>`;
    tbody.appendChild(tr);
  });

  if(!rows.length){
    tbody.innerHTML =
      `<tr><td colspan="8" style="text-align:center;">No history found</td></tr>`;
  }
}

/* ===== INIT ===== */
loadDriveInfo();
loadHistory();
</script>

</body>
</html>
