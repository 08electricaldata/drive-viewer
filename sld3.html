<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HT Panel IEC SLD</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Arial;
  margin:0;
  background:#f2f6ff;
}

.header-bar{
  position:sticky;
  top:0;
  background:#003f88;
  color:white;
  padding:12px;
  display:flex;
  gap:10px;
  align-items:center;
}

.header-bar button{
  background:white;
  color:#003f88;
  border:none;
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
}

.header-title{
  flex:1;
  text-align:center;
  font-weight:bold;
}

.container{ padding:15px; }

#wrap{
  height:560px;
  background:white;
  border:1px solid #ccc;
}

.bus{
  stroke:#000;
  stroke-width:6;
}

.power{
  stroke:#00cc44;
  stroke-width:4;
  stroke-dasharray:10 6;
  animation:flow 1s linear infinite;
}

@keyframes flow{
  to{ stroke-dashoffset:-30; }
}

.label{
  font-size:11px;
  text-anchor:middle;
}
</style>
</head>

<body>

<div class="header-bar">
  <button onclick="history.back()">‚¨Ö Back</button>
  <button onclick="location.href='https://08electricaldata.github.io/'">üè† Home</button>
  <div class="header-title" id="title">HT PANEL SLD</div>
</div>

<div class="container">
  <div id="wrap">
    <svg id="sld" viewBox="0 0 1600 700"></svg>
  </div>
</div>

<script>

// ===== CONFIG =====
const JSON_URL =
"https://raw.githubusercontent.com/08electricaldata/08electricaldata-json/main/sld/boards_sld.json";

const svg=document.getElementById("sld");

// ===== helpers =====
function line(x1,y1,x2,y2,cls=""){
  const l=document.createElementNS("http://www.w3.org/2000/svg","line");
  l.setAttribute("x1",x1);
  l.setAttribute("y1",y1);
  l.setAttribute("x2",x2);
  l.setAttribute("y2",y2);
  l.setAttribute("class",cls);
  svg.appendChild(l);
}

function text(x,y,t){
  const el=document.createElementNS("http://www.w3.org/2000/svg","text");
  el.setAttribute("x",x);
  el.setAttribute("y",y);
  el.setAttribute("class","label");
  el.textContent=t;
  svg.appendChild(el);
}

function breaker(x,y,label){

  // vertical contacts
  line(x,y-20,x,y-8,"");
  line(x,y+8,x,y+20,"");

  // blade
  line(x-10,y,x+10,y,"");

  text(x,y+34,label||"");
}

function transformer(x,y,name){

  const c1=document.createElementNS("http://www.w3.org/2000/svg","circle");
  c1.setAttribute("cx",x-12);
  c1.setAttribute("cy",y);
  c1.setAttribute("r",10);
  c1.setAttribute("stroke","#000");
  c1.setAttribute("fill","none");

  const c2=document.createElementNS("http://www.w3.org/2000/svg","circle");
  c2.setAttribute("cx",x+12);
  c2.setAttribute("cy",y);
  c2.setAttribute("r",10);
  c2.setAttribute("stroke","#000");
  c2.setAttribute("fill","none");

  svg.appendChild(c1);
  svg.appendChild(c2);

  text(x,y+26,name||"TR");
}

// ===== load =====
function getParam(n){
  return new URL(location.href).searchParams.get(n);
}

async function load(){

  const id=getParam("id");
  if(!id) return;

  title.innerText=id+" ‚Äî Panel SLD";

  const res=await fetch(JSON_URL);
  const data=await res.json();
  const board=data.boards[id];

  if(!board) return;

  draw(board);
}

// ===== main draw =====
function draw(board){

  svg.innerHTML="";

  const BUS_Y=300;
  const W=1600;

  // ===== MAIN BUS =====
  line(120,BUS_Y,W-120,BUS_Y,"bus");

  // ===== BUS COUPLER (CENTER) =====
  if(board.busCouplers?.length){
    const x=W/2;
    breaker(x,BUS_Y,board.busCouplers[0].breakerId);
  }

  // ===== INCOMERS (TOP) =====
  const incomers=[
    ...board.incomers,
    ...board.dgIncomers,
    ...board.emergencyIncomers
  ];

  const incSpacing=W/(incomers.length+1);

  incomers.forEach((inc,i)=>{

    const x=incSpacing*(i+1);

    // vertical drop
    line(x,160,x,BUS_Y-20,"power");

    // breaker
    breaker(x,BUS_Y-40,inc.breakerId);

    // transformer
    transformer(x,130,inc.source);
  });

  // ===== OUTGOINGS (BOTTOM) =====
  const outSpacing=W/(board.outgoings.length+1);

  board.outgoings.forEach((o,i)=>{

    const x=outSpacing*(i+1);

    // drop down
    line(x,BUS_Y+20,x,520,"");

    breaker(x,BUS_Y+40,o.breakerId);
  });
}

load();
</script>

</body>
</html>
