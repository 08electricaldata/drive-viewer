<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Industrial LT MCC Layout</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;margin:0;background:#f2f6ff}

.header{
  background:#003f88;
  color:white;
  padding:12px;
  text-align:center;
  font-size:20px;
  font-weight:700;
}

#boardWrapper{
  overflow:auto;
  padding:20px;
}

#boardContainer{
  display:flex;
  align-items:flex-start;
  position:relative;
  min-height:500px;
}

/* ================= BUSBAR ================= */

.busbar{
  position:absolute;
  top:65px;
  height:8px;
  background:#999;
  z-index:0;
}

.bus-live{
  background:#00cc44;
  animation:flow 1s linear infinite;
  background-image: repeating-linear-gradient(
    90deg,
    #00cc44,
    #00cc44 15px,
    #33ff77 15px,
    #33ff77 30px
  );
}

@keyframes flow{
  from{background-position:0 0;}
  to{background-position:40px 0;}
}

/* ================= SECTIONS ================= */

.section{
  background:white;
  border-radius:6px;
  box-shadow:0 3px 8px rgba(0,0,0,.2);
  margin-right:8px;
  display:flex;
  flex-direction:column;
  width:140px;
}

.section-title{
  background:#003f88;
  color:white;
  text-align:center;
  font-weight:bold;
  padding:6px;
  font-size:13px;
}

/* ================= CELLS ================= */

.cell{
  border:2px solid #333;
  padding:6px;
  margin:5px;
  font-size:11px;
  border-radius:4px;
  cursor:pointer;
  min-height:60px;        /* ðŸ”¹ Uniform height */
  display:flex;
  flex-direction:column;
  justify-content:center;
  text-align:center;
}

/* STATUS COLORS */
.status-on{
  border-color:#00aa00;
  background:#eaffea;
}

.status-off{
  border-color:#cc0000;
  background:#ffeaea;
}

.incomer{background:#d9f2d9}
.outgoing{background:#d9e8ff}
.coupler{background:#fff3b0}
.spare{background:#eee}

/* BUS COUPLER BRIDGE */
.coupler-bridge{
  position:absolute;
  width:6px;
  background:red;
  top:65px;
  height:70px;
  z-index:1;
}
</style>
</head>

<body>

<div class="header" id="title">LT MCC PANEL</div>

<div id="boardWrapper">
  <div id="boardContainer"></div>
</div>

<script>

const JSON_URL =
"https://raw.githubusercontent.com/08electricaldata/08electricaldata-json/main/sld/lt_sld.json";

function getParam(n){
  return new URL(location.href).searchParams.get(n);
}

async function load(){

  const boardId=getParam("id");
  if(!boardId) return;

  document.getElementById("title").innerText =
  boardId+" - Industrial LT MCC Layout";

  const res=await fetch(JSON_URL);
  const data=await res.json();

  const board=data.boards[boardId];
  if(!board) return;

  const container=document.getElementById("boardContainer");
  container.innerHTML="";

  const sections=Object.keys(board.sections)
    .sort((a,b)=>Number(a)-Number(b));

  const sectionWidth=150;
  container.style.width=(sections.length*sectionWidth)+"px";

  /* ================= BUSBAR ================= */
  const bus=document.createElement("div");
  bus.className="busbar";
  bus.style.left="0px";
  bus.style.width=(sections.length*sectionWidth-10)+"px";
  container.appendChild(bus);

  let busLive=false;

  /* ================= FIND MAX HEIGHT ================= */
  let maxDevices=0;
  sections.forEach(sec=>{
    const count=board.sections[sec].length;
    if(count>maxDevices) maxDevices=count;
  });

  sections.forEach((sec,index)=>{

    const secDiv=document.createElement("div");
    secDiv.className="section";

    const title=document.createElement("div");
    title.className="section-title";
    title.innerText="SECTION "+sec;
    secDiv.appendChild(title);

    const devices=board.sections[sec]
      .sort((a,b)=>a.level.localeCompare(b.level));

    devices.forEach(d=>{

      const cell=document.createElement("div");
      cell.className="cell";

      /* STATUS COLOR */
      if(d.status && d.status.toUpperCase()==="ON"){
        cell.classList.add("status-on");
        if(d.feederType==="INCOMER")
          busLive=true;
      }else{
        cell.classList.add("status-off");
      }

      if(d.feederType==="INCOMER")
        cell.classList.add("incomer");

      else if(d.feederType==="OUTGOING")
        cell.classList.add("outgoing");

      else if(d.feederType==="BUS_COUPLER"){
        cell.classList.add("coupler");

        const bridge=document.createElement("div");
        bridge.className="coupler-bridge";
        bridge.style.left=(index*sectionWidth + 72)+"px";
        container.appendChild(bridge);
      }

      else
        cell.classList.add("spare");

      cell.innerHTML=
      "<b>"+d.position+"</b><br>"+
      (d.driveid || "")+"<br>"+
      (d.DriveType || "");

      if(d.driveid){
        cell.onclick=function(){
          location.href=
          "https://08electricaldata.github.io/drive-viewer/index.html?id="+
          d.driveid;
        };
      }

      secDiv.appendChild(cell);
    });

    /* ðŸ”¹ ADD EMPTY CELLS FOR UNIFORM HEIGHT */
    const missing = maxDevices - devices.length;
    for(let i=0;i<missing;i++){
      const empty=document.createElement("div");
      empty.className="cell spare";
      empty.innerHTML="&nbsp;";
      secDiv.appendChild(empty);
    }

    container.appendChild(secDiv);
  });

  /* ðŸ”¹ BUS LIVE ANIMATION */
  if(busLive){
    bus.classList.add("bus-live");
  }
}

load();

</script>
</body>
</html>
