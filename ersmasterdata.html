<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ERS MASTER DATA</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { font-family: Arial, sans-serif; margin:0; background:#f2f6ff; }

/* HEADER */
.header { background:#003f88; color:#fff; padding:14px 16px; }
.header-bar { display:flex; align-items:center; justify-content:space-between; }
.header-btn {
  background:#fff; color:#003f88; border:none;
  padding:6px 10px; border-radius:6px;
  font-size:16px; cursor:pointer;
}
.header-center { text-align:center; flex:1; }
.header-center h1 { margin:0; font-size:26px; }

/* CONTROLS */
.controls {
  padding:15px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.controls input, .controls select {
  padding:8px;
  font-size:14px;
}

/* TABLE WRAPPER FOR SCROLL */
.table-wrapper {
  overflow-x:auto;
  padding:10px;
}

/* TABLE */
table {
  border-collapse:collapse;
  background:#fff;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
  table-layout:auto;         /* AUTO WIDTH */
  width:max-content;         /* expand based on content */
  min-width:100%;
}

th,td {
  border:1px solid #ccc;
  padding:8px 10px;
  text-align:center;
  white-space:nowrap;        /* prevent wrapping */
  font-size:13px;
}

th {
  background:#003f88;
  color:#fff;
  position:sticky;
  top:0;
  z-index:1;
}

/* DATE COLUMNS MIN WIDTH */
td:nth-child(2),
td:nth-child(19) {
  min-width:110px;
}

/* Hover */
tbody tr:hover { background:#eef5ff; }

/* STATUS BADGE */
.status-badge {
  color:#fff;
  font-weight:bold;
  padding:4px 8px;
  border-radius:4px;
  display:inline-block;
}

</style>
</head>

<body>

<div class="header">
  <div class="header-bar">
    <button class="header-btn" onclick="goHome()">üè† Home</button>
    <div class="header-center">
      <h1>ERS MASTER DATA</h1>
    </div>
    <div style="width:60px"></div>
  </div>
</div>

<div class="controls">
  <input id="search" placeholder="Search any field">
  <select id="areaFilter"><option value="">All Areas</option></select>
  <select id="statusFilter"><option value="">All Status</option></select>
  <select id="ersFilter"><option value="">All ERS Status</option></select>
</div>

<div class="table-wrapper">
<table id="tbl">
<thead>
<tr>
<th>SL</th><th>DATE</th><th>W.O NO</th><th>ERS STATUS</th>
<th>STATUS</th><th>SHIFTED TO</th><th>USE STATUS</th>
<th>KW</th><th>MAKE</th><th>FRAME</th><th>RPM</th>
<th>MOUNT</th><th>MOTOR SL</th><th>AREA</th>
<th>EQPT DETAILS</th><th>TYPE</th><th>DRIVE1</th><th>DRIVE2</th>
<th>DATE2</th><th>W.O2</th><th>KW2</th><th>MAKE2</th>
<th>MOUNT2</th><th>M/C NO</th><th>AREA2</th>
<th>LAST MOTORTR</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<script>
const JSON_URL =
"https://raw.githubusercontent.com/08electricaldata/08electricaldata-json/main/master/motor_transaction.json";

function goHome(){
  location.href="https://08electricaldata.github.io/";
}

function parseDate(v){
  if(!v) return null;
  const d=new Date(v);
  return isNaN(d)?null:d;
}

function formatDate(d){
  if(!d) return "";
  return `${String(d.getDate()).padStart(2,"0")}-${String(d.getMonth()+1).padStart(2,"0")}-${d.getFullYear()}`;
}

async function load(){
  const res=await fetch(JSON_URL);
  const data=await res.json();
  let rows=data.rows;

  /* Detect valid rows based on column B or C */
  rows=rows.filter(r=>r[1] || r[2]);

  /* Sort descending by DATE column B */
  rows.sort((a,b)=>{
    const d1=parseDate(a[1]);
    const d2=parseDate(b[1]);
    return (d2||0)-(d1||0);
  });

  const tbody=document.querySelector("#tbl tbody");

  const areaSet=new Set();
  const statusSet=new Set();
  const ersSet=new Set();

  rows.forEach(r=>{
    if(r[13]) areaSet.add(r[13]);
    if(r[4]) statusSet.add(r[4]);
    if(r[3]) ersSet.add(r[3]);
  });

  const areaFilter=document.getElementById("areaFilter");
  const statusFilter=document.getElementById("statusFilter");
  const ersFilter=document.getElementById("ersFilter");

  [...areaSet].sort().forEach(v=>areaFilter.innerHTML+=`<option>${v}</option>`);
  [...statusSet].sort().forEach(v=>statusFilter.innerHTML+=`<option>${v}</option>`);
  [...ersSet].sort().forEach(v=>ersFilter.innerHTML+=`<option>${v}</option>`);

  /* Unique color for STATUS */
  const statusColors={};
  let hue=0;
  statusSet.forEach(s=>{
    statusColors[s]=`hsl(${hue},70%,45%)`;
    hue+=45;
  });

  function render(){
    tbody.innerHTML="";
    const q=search.value.toLowerCase();
    const areaSel=areaFilter.value;
    const statusSel=statusFilter.value;
    const ersSel=ersFilter.value;

    rows.forEach(r=>{
      if(areaSel && r[13]!==areaSel) return;
      if(statusSel && r[4]!==statusSel) return;
      if(ersSel && r[3]!==ersSel) return;
      if(q && !r.join(" ").toLowerCase().includes(q)) return;

      const tr=document.createElement("tr");

      let statusCell = r[4]
        ? `<span class="status-badge" style="background:${statusColors[r[4]]}">
            ${r[4]}
           </span>`
        : "";

      tr.innerHTML=`
        <td>${r[0]||""}</td>
        <td>${formatDate(parseDate(r[1]))}</td>
        <td>${r[2]||""}</td>
        <td>${r[3]||""}</td>
        <td>${statusCell}</td>
        <td>${r[5]||""}</td>
        <td>${r[6]||""}</td>
        <td>${r[7]||""}</td>
        <td>${r[8]||""}</td>
        <td>${r[9]||""}</td>
        <td>${r[10]||""}</td>
        <td>${r[11]||""}</td>
        <td>${r[12]||""}</td>
        <td>${r[13]||""}</td>
        <td>${r[14]||""}</td>
        <td>${r[15]||""}</td>
        <td>${r[16]||""}</td>
        <td>${r[17]||""}</td>
        <td>${formatDate(parseDate(r[18]))}</td>
        <td>${r[19]||""}</td>
        <td>${r[20]||""}</td>
        <td>${r[21]||""}</td>
        <td>${r[22]||""}</td>
        <td>${r[23]||""}</td>
        <td>${r[24]||""}</td>
        <td>${r[25]||""}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  search.onkeyup=render;
  areaFilter.onchange=render;
  statusFilter.onchange=render;
  ersFilter.onchange=render;

  render();
}

load();
</script>

</body>
</html>
