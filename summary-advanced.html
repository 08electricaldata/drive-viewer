<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>08 Electrical Data</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f6ff;
  margin: 0;
}

.header {
  background: #003f88;
  color: white;
  padding: 30px 15px;
  text-align: center;
}
.header h1 { margin: 0; font-size: 36px; }
.header p { margin-top: 8px; opacity: 0.9; }

.container {
  max-width: 1100px;
  margin: 30px auto;
  padding: 0 15px;
  display: grid;
  grid-template-columns: 280px 1fr 1fr;
  gap: 20px;
}

.card {
  background: white;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  padding: 25px;
  margin-bottom: 20px;
}

.card h2 {
  margin-top: 0;
  color: #003f88;
  text-align: center;
}

/* ===== MASTER LIST ===== */
.master-btns {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.master-btns a {
  text-decoration: none;
}

.master-btns button {
  width: 100%;
  padding: 12px;
  font-size: 15px;
  background: #003f88;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
.master-btns button:hover { opacity: 0.9; }

/* ===== DRIVE SELECT ===== */
.select-row {
  display: flex;
  gap: 15px;
  justify-content: center;
  flex-wrap: wrap;
}

select {
  padding: 12px;
  font-size: 16px;
  border-radius: 6px;
  border: 1px solid #ccc;
  min-width: 260px;
}

.button-row {
  margin-top: 20px;
  display: flex;
  gap: 15px;
  justify-content: center;
  flex-wrap: wrap;
}

.button-row button {
  padding: 12px 28px;
  font-size: 16px;
  background: #003f88;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
.button-row button:hover { opacity: 0.9; }

.footer {
  text-align: center;
  padding: 15px;
  font-size: 14px;
  color: #555;
}

/* ===== MOBILE ===== */
@media (max-width: 1000px) {
  .container {
    grid-template-columns: 1fr;
  }
}
@media (max-width: 600px) {
  select, .button-row button { width: 100%; }
}
</style>
</head>

<body>

<div class="header">
  <h1>08 Electrical Data</h1>
  <p>Drive Information & Maintenance History</p>
</div>

<div class="container">

  <!-- ===== LEFT : MASTER LIST ===== -->
  <div class="card">
    <h2>Master List</h2>

    <div class="master-btns">
      <a href="https://08electricaldata.github.io/drive-viewer/motorlist.html">
        <button>‚öôÔ∏è Motor List</button>
      </a>

      <a href="https://08electricaldata.github.io/drive-viewer/trafolist.html">
        <button>‚ö° Transformer List</button>
      </a>
    </div>
  </div>

  <!-- ===== MIDDLE : DRIVE SELECT ===== -->
  <div class="card">
    <h2>Select Drive</h2>

    <div class="select-row">
      <select id="mainDrive">
        <option value="">Select Main Drive</option>
      </select>

      <select id="subDrive">
        <option value="">Select Sub Drive</option>
      </select>
    </div>

    <div class="button-row">
      <button onclick="openPage('view')">VIEW</button>
      <button onclick="openPage('history')">HISTORY</button>
    </div>
  </div>

  <!-- ===== RIGHT : JOBS ===== -->
  <div class="card">
    <h2>Jobs</h2>

    <div class="button-row">
      <button onclick="openJobPage()">üìÖ DATEWISE JOBS</button>
    </div>
  </div>

</div>

<div class="footer">
  ¬© 08 Electrical Data | GitHub Pages
</div>

<script>
const SHEET_URL =
  "https://docs.google.com/spreadsheets/d/1Ar9-a9u4b622-6i8b889qGqENI8rl8Q2U6PPOPBaLDc/gviz/tq" +
  "?gid=198891854&tqx=out:json";

let headers = [];
let rows = [];
let sheetPassword = "";

// ---------- LOAD SHEET ----------
async function loadSheet() {
  const cache = localStorage.getItem("driveSheetFull");
  if (cache) {
    const d = JSON.parse(cache);
    headers = d.headers;
    rows = d.rows;
    sheetPassword = d.password;
    buildMain();
    return;
  }

  const r = await fetch(SHEET_URL);
  const t = await r.text();
  const j = JSON.parse(t.substring(47, t.length - 2));

  headers = j.table.cols.slice(7).map(c => c.label);
  rows = j.table.rows.map(r => r.c.map(c => c?.v || ""));
  sheetPassword = (j.table.rows[2]?.c[6]?.v || "").toString().trim();

  localStorage.setItem(
    "driveSheetFull",
    JSON.stringify({ headers, rows, password: sheetPassword })
  );

  buildMain();
}

// ---------- MAIN DRIVE ----------
function buildMain() {
  const main = document.getElementById("mainDrive");
  headers.forEach((h, i) => {
    const o = document.createElement("option");
    o.value = i;
    o.textContent = h;
    main.appendChild(o);
  });
}

document.getElementById("mainDrive").onchange = function () {
  const idx = this.value;
  const sub = document.getElementById("subDrive");
  sub.innerHTML = "<option value=''>Select Sub Drive</option>";
  if (idx === "") return;

  rows.forEach(r => {
    const val = r[+idx + 7];
    if (val) {
      const o = document.createElement("option");
      o.value = val;
      o.textContent = val;
      sub.appendChild(o);
    }
  });
};

// ---------- OPEN VIEW / HISTORY ----------
function openPage(type) {
  const mainSel = document.getElementById("mainDrive");
  const subSel = document.getElementById("subDrive");

  if (!mainSel.value || !subSel.value) {
    alert("Please select Main Drive and Sub Drive");
    return;
  }

  const entered = prompt("üîê Enter Password");
  if (entered !== sheetPassword) {
    alert("Incorrect password");
    return;
  }

  const id = `${mainSel.selectedOptions[0].text}-${subSel.value}`;
  const base =
    type === "view"
      ? "drive-viewer/index.html?id="
      : "drive-viewer/history.html?id=";

  window.location.href =
    "https://08electricaldata.github.io/" +
    base +
    encodeURIComponent(id);
}

// ---------- OPEN DATEWISE JOBS ----------
function openJobPage() {
  const entered = prompt("üîê Enter Password");
  if (entered !== sheetPassword) {
    alert("Incorrect password");
    return;
  }

  window.location.href =
    "https://08electricaldata.github.io/drive-viewer/summary-date.html";
}

loadSheet();
</script>

</body>
</html>
